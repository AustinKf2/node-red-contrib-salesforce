<script type="text/javascript">
    RED.nodes.registerType('connection-config', {
        category: 'config',
        defaults: {
            name: {
                value: '',
                required: true
            },
            poturl: {
                value: '',
                required: false
            },
            consumerKey: {
                required: true
            },
            consumerSecret: {
                required: true
            },
            callbackUrl: {
                required: true
            },
            environment: {
                value: 'production',
                required: true
            },
            useEnvCredentials: {
                value: true
            },
            username: {
                required: false
            },
            password: {
                required: false
            },
        },
        label: function() {
            return this.name || this.username + ' connection';
        },
        oneditprepare: function() {

            setTimeout(function() {
                var jqCurDialog = $("[aria-describedby='node-config-dialog']:visible");
                var dialogWidth = ($(window).width() - 100);
                if (dialogWidth > 700) {
                    dialogWidth = 700;
                }
                jqCurDialog.css('width', dialogWidth);
                jqCurDialog.css('left', (($(window).width() - dialogWidth) / 2));
                // jqCurDialog.css('min-height', '580px');
                // increase for form field size
                $(".form-row label").width('150px');
            }, 0);

            $("#node-config-input-useEnvCredentials").change(function() {
                if ($("#node-config-input-useEnvCredentials").val()) {
                    $(".credentials").hide();
                } else {
                    $(".credentials").show();
                }
            });
        },

        // reset the form label size
        oneditsave: function() {
            $(".form-row label").width('100px');
        },
        // reset the form label size
        oneditcancel: function() {
            $(".form-row label").width('100px');
        },
        oneditdelete: function() {
            $(".form-row label").width('100px');
        }
    });
</script>

<script type="text/x-red" data-template-name="connection-config">
    <div class="form-row">
        <label for="node-config-input-name"><i class="icon-bookmark"></i> Name</label>
        <input type="text" id="node-config-input-name">
    </div>
    <div class="form-row">
        <label for="node-config-input-poturl"><i class="icon-bookmark"></i> Instance URL</label>
        <input type="text" id="node-config-input-poturl">
    </div>
    <div class="form-row" style="white-space:nowrap">
        <label for="node-config-input-callbackUrl"><i class="fa fa-history"></i> Callback URL</label>
        <input type="text" id="node-config-input-callbackUrl" placeholder="http://localhost:3000/oauth/_callback">
    </div>
    <div class="form-row">
        <label for="node-config-input-environment"><i class="fa fa-tasks"></i> Environment</label>
        <select id="node-config-input-environment">
          <option value="production">Production</option>
          <option value="sandbox">Sandbox</option>
        </select>
    </div>
    <div class="form-row credentials">
        <input type="checkbox" id="node-config-input-useEnvCredentials">
        <label for="node-config-input-useEnvCredentials"><i class="fa fa-user"></i> Use environment credentials</label>
    </div>
    <div class="form-row credentials" style="white-space:nowrap">
        <label for="node-config-input-consumerKey"><i class="fa fa-key"></i> Consumer Key</label>
        <input type="text" id="node-config-input-consumerKey">
    </div>
    <div class="form-row credentials" style="white-space:nowrap">
        <label for="node-config-input-consumerSecret"><i class="fa fa-user-secret"></i> Consumer Secret</label>
        <input type="password" id="node-config-input-consumerSecret">
    </div>
    <div class="form-row credentials">
        <label for="node-config-input-username"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-config-input-username">
    </div>
    <div class="form-row">
        <label for="node-config-input-password"><i class="fa fa-lock"></i> Password</label>
        <input type="password" id="node-config-input-password">
    </div>
</script>

<script type="text/x-red" data-help-name="connection-config">
    <h3>Setting up a config node</h3>
    <ul>
        <li><b>Name</b>: NodeRED internal name of the connection. When you use environment credentials: prefix of the credential variables (see below)
        </li>
        <li><b>Instance URL</b>: URL to your Salesforce instance (optional). Use it when you get "invalid client id" errors when connecting to Salesforce or when you use a ScratchOrg
        </li>
        <li><b>Callback URL</b>: needs to match the setting in the connected app. use <code>&lt;NodeRedURL&gt;/oauth/_callback</code> as default
        </li>
        <li><b>Environment</b>: Production or Sandbox. DevEditions are Sandbox
        </li>
        <li><b>Use environment credentials</b>: Ignores the Consumer Key, Consumer Secret, username/password below and tries to read environment variables (e.g from a Heroku deployment). The variables are the name of this node and _ConsumerKey, _ConsumerSecret,
            _UserName and _Password. So if this Node is called SFTest, it will look for <code>SFTest_ConsumerKey</code>,<code>SFTest_ConsumerSecret</code>, <code>SFTest_UserName</code>, <code>SFTest_PassWord</code>. Typically this is the integration user
        </li>
        <li><b>Consumer Key / Consumer Secret</b>: Values from the Connected App setting in your instance
        </li>
        <li><b>Username/Password</b>: Credentials to get an Oauth token. Typically integration user. Not recommended, use environment instead. If missing will also try to read the environment
        </li>
    </ul>
</script>